---
import type { Language } from '@/i18n/config'
import Button from '@/components/Button.astro'
import CategoryMenu from '@/components/CategoryMenu.astro'
import { themeConfig } from '@/config'
import { ui } from '@/i18n/ui'
import { getPageInfo } from '@/utils/page'

interface Props {
  supportedLangs?: Language[]
}

const { supportedLangs = [] } = Astro.props
const { currentLang, getLocalizedPath, isHome, isPost } = getPageInfo(Astro.url.pathname)
const { title, subtitle, i18nTitle } = themeConfig.site

const currentUI = ui[currentLang as keyof typeof ui] ?? {}
const headerTitle = i18nTitle ? currentUI.title : title
const headerSubtitle = i18nTitle ? currentUI.subtitle : subtitle

const TitleTag = isHome ? 'h1' : 'div'
const SubtitleTag = isHome ? 'h2' : 'div'
---

<header
  class:list={[
    'lg:(uno-desktop-column top-20) cjk:tracking-wide',
    isPost
    ? 'mb-5'
    : 'mb-5',
  ]}
>

  <TitleTag
    class:list={[
      'font-bold font-title',
      isPost
        ? `mb-2.8 mt-3 text-5.375 c-secondary lg:(mb-1.8 mt-0 text-9 c-primary)`
        : `mb-1.8 w-75% text-8 c-primary lg:(w-full text-9)`,
    ]}
  >
    <!-- Fix text cropping issues during view transition on iOS by adding a div tag -->
    <div
      class="box-content inline-block pr-1"
      transition:name={`site-title-${currentLang}`}
      data-disable-theme-toggle-transition
    >
      <a
        id="site-title-link"
        href={getLocalizedPath('/')}
      >
          {headerTitle}
      </a>
    </div>
  </TitleTag>

  {headerSubtitle && (
    <SubtitleTag
      class:list={[
        'text-3.5 c-secondary font-navbar lg:text-4',
        isPost
        ? `op-0 lg:op-100`
        : 'w-75% lg:w-full',
      ]}
      aria-hidden={isPost}
    >
      {headerSubtitle}
    </SubtitleTag>
  )}
  <CategoryMenu />
  <Button supportedLangs={supportedLangs} />
</header>
